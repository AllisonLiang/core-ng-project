<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/@hpcc-js/wasm/dist/index.min.js" type="application/javascript"></script>
<script src="https://unpkg.com/d3-graphviz@3.1.0/build/d3-graphviz.js"></script>
<div id="graph" style="text-align: center;"></div>
<style>
    svg {
        text-align: center;
        width: 100vw;
        height: 100vh;
    }

    div.tooltip {
        position: absolute;
        text-align: center;
        width: 60px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }
</style>
<script>
    var dotSrc = `
digraph G {
"0" [label="website\\nAccountAJAXService", shape="box"];
"1" [label="customer-service\\nRegisterService", shape="box", color=blue];
"2" [label="wallet-service\\nWalletService", shape="box"];
"3" [label="customer-service\\nLoginService", shape="box", color=red];
"5" [label="customer-service\\nLoginHistoryService", shape="box"];
"0" -> "1" [arrowhead="open", arrowtail="none", fontsize=10, label="action:/customer/register"];
"1" -> "2" [arrowhead="open", arrowtail="none", fontsize=10, label="action:/wallet/create"];
"1" -> "3" [arrowhead="open", arrowtail="none", fontsize=10, label="action:/customer/login"];
"3" -> "5" [arrowhead="open", arrowtail="none", style=dashed, fontsize=10, label="action:/login-history"];
}
`;

    var graphviz = d3.select("#graph").graphviz();

    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    function render() {
        graphviz
            .transition(function () {
                return d3.transition()
                    .delay(100)
                    .duration(1000);
            })
            .renderDot(dotSrc)
            .on("end", interactive);
    }

    function interactive() {
        nodes = d3.selectAll('.node');
        nodes
            .on("mouseover", function () {
                text = d3.select(this).selectAll('title').text();
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div.html("node:" + text)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px")
                    .style("background", "lightsteelblue");
            })
            .on("mouseout", function () {
                div.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        edges = d3.selectAll('.edge');
        edges
            .on("mouseover", function () {
                text = d3.select(this).selectAll('title').text();
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div.html("edge:" + text)
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px")
                    .style("background", "lightyellow");
            })
            .on("mouseout", function () {
                div.transition()
                    .duration(500)
                    .style("opacity", 0);
            });
    }

    render(dotSrc);

</script>
